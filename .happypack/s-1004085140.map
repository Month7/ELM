{"version":3,"sources":["src\\js\\register\\mobile\\event.js"],"names":["opts","mobileVerifyToken","$mobileInput","$verifyInput","$verifyBtn","$mobileBtn","$verifyMobile","$dialog","$dialogClose","$verifyForm","$mobileForm","slider","container","success","$wrapper","$text","offsetArr","offsetMsg","join","data","code","innerHTML","removeAttribute","onclick","checkResult","console","log","length","type","alert","mobile","value","style","display","reset","oninput","MSGLENGTH","replace","substring","setAttribute","innerText","verifyCode"],"mappings":"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","file":"event.js","sourceRoot":"D:/account-system-sdk","sourcesContent":["import Slider from'../../common/slider.js';\r\nimport {getId as $,addClass, removeClass} from '../../common/utils.js';\r\nimport { fetchPost } from '../../common/fetch.js';\r\nimport {check} from '../../common/from-check.js';\r\n\r\nexport default(opts)=>{\r\n    let mobileVerifyToken;\r\n\r\n    const $mobileInput = $('register-mobile-input');\r\n    const $verifyInput = $('register-verify-input');\r\n    const $verifyBtn = $('register-verify-btn');\r\n    const $mobileBtn = $('register-mobile-btn');\r\n    const $verifyMobile = $('register-verify-mobile');\r\n    const $dialog = $('register-verify-dialog');\r\n    const $dialogClose = $('register-verify-dialog-close');\r\n    const $verifyForm=$('register-verify-form');\r\n    const $mobileForm = $('register-mobile-form');\r\n\r\n    const slider =new Slider({\r\n        container:$('register-verify-wrapper'),\r\n        success:async ($wrapper,$text,offsetArr)=>{\r\n            const offsetMsg=offsetArr.join(\":\");\r\n            let data = await fetchPost('/getMobileVerifyToken', {});\r\n            if(data.code==200){\r\n                mobileVerifyToken=data.mobileVerifyToken;\r\n                addClass($wrapper,'success');\r\n                $text.innerHTML=\"验证成功\";\r\n                $verifyBtn.removeAttribute('disabled');\r\n                removeClass($verifyBtn,'disabled');\r\n            }\r\n            else{\r\n                addClass($wrapper,'failed');\r\n                $text.innerHTML=\"验证失败\";\r\n            }\r\n        }\r\n    })\r\n    $verifyBtn.onclick=async()=>{\r\n        \r\n        let checkResult=check($mobileForm);\r\n        console.log(checkResult);\r\n        if(checkResult.length){\r\n            const type=checkResult[0].type;\r\n            \r\n            if(type=='present'){\r\n                alert(\"请填写您的手机号!\");\r\n            }\r\n            else if(type=='mobile'){\r\n                alert(\"请填写正确的手机号\");\r\n            }\r\n        }\r\n        else{\r\n            let data=await fetchPost('/register/getVerifyCode',{\r\n                mobile:$mobileInput.value,\r\n                mobileVerifyToken:mobileVerifyToken\r\n            })\r\n            if(data.code==200){\r\n                $dialog.style.display='block';\r\n                $verifyMobile.innerHTML=data.mobile;\r\n                mobileVerifyToken='';\r\n                slider.reset();\r\n            }\r\n            else{\r\n                alert(\"失败\");\r\n            }\r\n        }\r\n    }\r\n    $dialogClose.onclick=()=>{\r\n        $dialog.style.display='none';\r\n        mobileVerifyToken='';\r\n        slider.reset();\r\n    }\r\n    $verifyInput.oninput=()=>{\r\n        const MSGLENGTH=6;\r\n        let value=$verifyInput.value;\r\n        $verifyInput.value=value.replace(/\\D/g,'');\r\n        if($verifyInput.value.length>MSGLENGTH-1){\r\n            $mobileBtn.removeAttribute('disabled');\r\n            removeClass($mobileBtn,'disabled');\r\n            addClass($mobileBtn,'btn-primary');\r\n            if($verifyInput.value.length>MSGLENGTH){\r\n                $verifyInput.value=$verifyInput.value.substring(0,MSGLENGTH);\r\n            }\r\n        }\r\n        else{\r\n            $mobileBtn.setAttribute('disabled','disabled');\r\n            removeClass($mobileBtn,'btn-primary');\r\n            addClass($mobileBtn,'disabled');\r\n        }\r\n    }\r\n    $mobileBtn.onclick=async()=>{\r\n        let data=await fetchPost('/register/mobile',{\r\n            mobile:$verifyMobile.innerText,\r\n            verifyCode:$verifyInput.value,\r\n            mobileVerifyToken:mobileVerifyToken\r\n        })\r\n        if(data.code==200){\r\n            if(opts.success){\r\n                opts.success();\r\n            }\r\n        }\r\n        else{\r\n            alert(\"验证码错误\");\r\n        }\r\n    }\r\n}"]}