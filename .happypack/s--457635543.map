{"version":3,"sources":["src\\js\\forget\\event.js"],"names":["opts","findInfo","$chooseMobile","$chooseEmail","$dialog","forget","type","$verifyInput","$forgetBtn","$number","$close","typeAlias","typeTool","sendVerifyCode","code","style","display","oninput","MSGLENGTH","value","replace","length","removeAttribute","substring","setAttribute","alert","onclick","innerHTML","number","innerText","verifyCode","data","success","mobile","email"],"mappings":"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","file":"event.js","sourceRoot":"D:/account-system-sdk","sourcesContent":["import {fetchPost,fetchJson} from '../common/fetch.js';\r\nimport {getId as $,addClass,removeClass} from '../common/utils.js';\r\nimport findTpl from './findTpl.js';\r\n\r\nexport default async(opts)=>{\r\n    const findInfo=await fetchJson('/security-info',{});\r\n    const $chooseMobile = $('choose-mobile');\r\n    const $chooseEmail = $('choose-email');\r\n    const $dialog = $('forget-dialog');\r\n\r\n    const forget=async(type)=>{\r\n       \r\n        const $verifyInput = $('forget-verify-input');\r\n        const $forgetBtn = $('forget-confirm-btn');\r\n        const $number = $('forget-verify-number');\r\n        const $close = $('forget-dialog-close');\r\n        const typeAlias = (type === '邮箱') ? 'email' : 'mobile';\r\n        const typeTool = (type === '邮箱') ? '邮件' : '短信';\r\n        const sendVerifyCode=await fetchPost('/send-forget-verifycode',{\r\n            type:type\r\n        });\r\n        if(sendVerifyCode.code==200){\r\n            $dialog.style.display='block';\r\n            $verifyInput.oninput = () => {\r\n                const MSGLENGTH = 6;\r\n                let value = $verifyInput.value;\r\n                //过滤非数字输入\r\n                $verifyInput.value = value.replace(/\\D/g, '');\r\n                //长度过滤\r\n                if ($verifyInput.value.length > (MSGLENGTH - 1)) {\r\n                    $forgetBtn.removeAttribute('disabled');\r\n                    removeClass($forgetBtn, 'disabled');\r\n                    addClass($forgetBtn, 'btn-primary');\r\n                    if (value.length > MSGLENGTH) {\r\n                        $verifyInput.value = value.substring(0, MSGLENGTH);\r\n                    }\r\n                }\r\n                else {\r\n                    removeClass($forgetBtn, 'btn-primary');\r\n                    addClass($forgetBtn, 'disabled');\r\n                    $forgetBtn.setAttribute('disabled', 'disabled');\r\n                }\r\n            }\r\n        }\r\n        else{\r\n            alert(\"发送\"+typeTool+\"失败\");\r\n        }\r\n        $close.onclick=()=>{\r\n            $dialog.style.display='none';\r\n            $verifyInput.value='';\r\n            $number.innerHTML='';\r\n        };\r\n        $forgetBtn.onclick=async ()=>{\r\n            let data=await fetchPost('/forget',{\r\n                number:$number.innerText,\r\n                verifyCode:$verifyInput.value\r\n            });\r\n           \r\n            if(data.code==200){\r\n                \r\n                opts.success&&opts.success(type,typeTool);\r\n            }\r\n            else{\r\n                alert(\"验证码错误\");\r\n            }\r\n        }\r\n    }\r\n  \r\n    $chooseMobile.onclick=()=>{\r\n        $dialog.innerHTML=findTpl('手机',findInfo.data.mobile);\r\n        forget('mobile');\r\n    }\r\n    $chooseEmail.onclick=()=>{\r\n        $dialog.innerHTML=findTpl('邮箱',findInfo.data.email);\r\n        forget('email');\r\n    }\r\n}"]}